<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="style/pure-min.css">
    <script defer src="js/alpinejs.min.js"></script>
    <script src="js/axios.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wakener Config</title>
</head>

<body>
    <div x-data="data()">
        <div class="pure-u-3-24"></div>
        <div class="pure-u-20-24">
            <form class="pure-form pure-form-aligned">
                <fieldset>
                    <div class="pure-control-group">
                        <label for="aligned-name">WiFi SSID</label>
                        <input type="text" id="aligned-name" placeholder="WiFi SSID" x-model="form.stSSID" />
                        <!-- <span class="pure-form-message-inline">This is a required field.</span> -->
                    </div>
                    <div class="pure-control-group">
                        <label for="aligned-password">WiFi Password</label>
                        <input type="password" id="aligned-password" placeholder="WiFi Password"
                            x-model="form.stPASS" />
                    </div>
                    <div class="pure-control-group">
                        <label for="aligned-wol-port">WOL Port(default: 9)</label>
                        <input type="number" id="aligned-wol-port" x-model="form.wolPort" />
                    </div>
                    <div class="pure-control-group">
                        <label for="aligned-wol-port">MQTT Enable</label>
                        <input type="checkbox" id="aligned-mqtt-switch" x-model="form.mqttEn">
                    </div>
                    <div x-show="form.mqttEn">
                        <div class="pure-control-group">
                            <label for="aligned-mqtt-host">MQTT Host</label>
                            <input type="text" id="aligned-mqtt-host" placeholder="MQTT Host" x-model="form.mqttHost" />
                        </div>
                        <div class="pure-control-group">
                            <label for="aligned-mqtt-port">MQTT Port</label>
                            <input type="number" id="aligned-mqtt-port" placeholder="MQTT Port"
                                x-model.number="form.mqttPort" />
                        </div>
                        <div class="pure-control-group">
                            <label for="aligned-mqtt-username">MQTT Username</label>
                            <input type="text" id="aligned-mqtt-username" placeholder="MQTT Username"
                                x-model="form.mqttUsername" />
                        </div>
                        <div class="pure-control-group">
                            <label for="aligned-mqtt-password">MQTT Password</label>
                            <input type="password" id="aligned-mqtt-password" placeholder="MQTT Password"
                                x-model="form.mqttPass" />
                        </div>
                        <div class="pure-control-group">
                            <label for="aligned-mqtt-topic">MQTT Topic</label>
                            <input type="text" id="aligned-mqtt-topic" placeholder="MQTT Topic"
                                x-model="form.mqttTopic" />
                        </div>
                    </div>
                    <div style="color: green" x-show="successfulInfo">Configuration update succeeded,please reboot to work.</div>
                    <div class="pure-controls">
                        <button class="pure-button pure-button-primary" type="button"
                            x-on:click="submit">Submit</button>
                    </div>
                </fieldset>
            </form>
        </div>
        <script type="text/javascript">
            function data() {
                return {
                    form: {
                        stSSID: '',
                        stPASS: '',
                        wolPort: 9,
                        mqttEn: false,
                        mqttHost: '',
                        mqttPort: '',
                        mqttUsername: '',
                        mqttPass: '',
                        mqttTopic: 0
                    },
                    successfulInfo: false,
                    async init() {
                        let res = await axios.get("/config");
                        console.log(res.data);
                        this.form = res.data
                    }
                }
            }

            async function submit() {
                console.log(this.form);
                let res = await axios.post("/update-config", this.form)
                if (res.data === 'ok') {
                    this.successfulInfo = true;
                }
            }
        </script>
    </div>
</body>

</html>